/*!
 * jQuery Chrome Tabs Plugin v0.1
 * https://github.com/riga/jquery.ctabs
 *
 * Copyright 2012, Marcel Rieger
 * Dual licensed under the MIT or GPL Version 3 licenses.
 * http://www.opensource.org/licenses/mit-license
 * http://www.opensource.org/licenses/GPL-3.0
 */
(function(a){a.widget("custom.ctabs",{version:"0.1",options:{active:0,add:null,afterAdd:null,afterDeselect:null,afterRemove:null,afterSelect:null,beforeDeselect:null,beforeRemove:null,beforeSelect:null,cssFlex:true,headLeft:"",headLeftWidth:0,headRight:"",headRightWidth:0,height:"100%",icon:"span",iconFormatter:null,marker:"*",showHash:false,width:"100%"},_settings:{overlap:20,resizeCacheDelay:500},_workflow:{currentHash:null,resizeTimeout:null,minTabWidth:null,maxTabWidth:null},_create:function(){this._prepare();
this._setupTarget();this._initialFill();},_setOption:function(b,c){switch(b){case"active":if(!this._applyActive(c)){return;}break;case"cssFlex":return;
break;case"headLeft":if(!this._applyHeadLeft(c)){return;}break;case"headLeftWidth":if(!this._applyHeadLeftWidth(c)){return;}break;case"headRight":if(!this._applyHeadRight(c)){return;
}break;case"headRightWidth":if(!this._applyHeadRightWidth(c)){return;}break;case"height":if(!this._applyHeight(c)){return;}break;case"icon":return;break;
case"marker":if(!this._applyMarker(c)){return;}break;case"maxTabWidth":if(!this._applyMaxTabWidth(c)){return;}break;case"minTabWidth":if(!this._applyMinTabWidth(c)){return;
}break;case"width":if(!this._applyWidth(c)){return;}break;default:break;}this._super(b,c);},_refresh:function(){this._applyActive(this.options.active);
this._applyHeadLeft(this.options.headLeft);this._applyHeadLeftWidth(this.options.headLeftWidth);this._applyHeadRight(this.options.headRight);this._applyHeadRightWidth(this.options.headRightWidth);
this._applyHeight(this.options.height);this._applyMarker(this.options.marker);this._applyWidth(this.options.width);this._resize();},_prepare:function(){var d=this;
var b=this.element.find("ol, ul").first().hide();var c=b.children();this.store={};this.hashes=[];c.each(function(){var f=a("a",this).first();var h=f.get(0).hash;
var g=a(d.options.icon,this).first();var e=d.element.children(h).first();d.store[h]={hash:h,tab:a(this),anchor:f,panel:e,icon:g};d.hashes.push(h);});},_setupTarget:function(){var g=this;
var k=a("<div>").addClass("ctabs-head").appendTo(this.element);var f=a("<div>").addClass("ctabs-body").appendTo(this.element);var p=a("<div>").addClass("ctabs-head-left-wrapper").appendTo(k);
var h=a("<div>").addClass("ctabs-head-table").appendTo(p);var m=a("<div>").addClass("ctabs-table-cell-center").appendTo(h);var n=a("<div>").addClass("ctabs-head-right-wrapper").appendTo(k);
var o=a("<div>").addClass("ctabs-head-table").appendTo(n);var j=a("<div>").addClass("ctabs-table-cell-center").appendTo(o);var c=a("<div>").addClass("ctabs-head-center-wrapper").appendTo(k);
var e=a("<div>").addClass("ctabs-head-center").addClass(this.options.cssFlex?"ctabs-head-center-flex":"ctabs-head-center-fix").appendTo(c);var b=a("<div>").addClass("ctabs-adder").appendTo(e).click(function(){if(a.isFunction(g.options.add)){g.options.add.apply(null,arguments);
}});var i=a("<div>").addClass("ctabs-head-table").appendTo(b);var l=a("<div>").addClass("ctabs-table-cell-center").appendTo(i);a("<span>").html("+").appendTo(l);
var d=this.options.cssFlex?{}:{placeholder:"ctabs-ctab-fix-placeholder",start:function(q,r){r.placeholder.css("width",r.item.width()-g._settings.overlap);
}};a(e).sortable(a.extend({axis:"x",cursor:"move",distance:20,tolerance:"pointer",items:".ctabs-ctab",stop:function(q,r){g._stopSort();}}),d).disableSelection();
this._nodes={body:f,head:k,headLeftWrapper:p,headLeft:m,headRightWrapper:n,headRight:j,headCenterWrapper:c,headCenter:e,adder:b};},_initialFill:function(){var b=this;
a.each(this.store,function(c){b._createCTab(c,undefined);});this._refresh();},_createCTab:function(b){var h=this;this.store[b].tab.hide();this.store[b].panel.hide().appendTo(this._nodes.body);
var r=a("<div>").addClass("ctabs-ctab ctabs-ctab-dimensions").addClass(this.options.cssFlex?"ctabs-ctab-flex":"ctabs-ctab-fix").attr("hash",b).insertBefore(this._nodes.adder).click(function(t){t.stopPropagation();
h.select(b);});var d=a("<div>").addClass("ctabs-ctab-left-wrapper").appendTo(r);a("<div>").addClass("ctabs-ctab-left").appendTo(d);var i=a("<div>").addClass("ctabs-ctab-right-wrapper").appendTo(r);
a("<div>").addClass("ctabs-ctab-right").appendTo(i);var o=a("<div>").addClass("ctabs-ctab-center").appendTo(r);var n=a("<div>").addClass("ctabs-ctab-icon-wrapper").appendTo(o);
var j=a("<div>").addClass("ctabs-head-table").appendTo(n);var g=a("<div>").addClass("ctabs-table-cell-left").append(this.store[b].icon).appendTo(j);var k=a("<div>").addClass("ctabs-ctab-close-wrapper").appendTo(o);
var q=a("<div>").addClass("ctabs-head-table").appendTo(k);var m=a("<div>").addClass("ctabs-table-cell-right").append("x").appendTo(q).click(function(t){t.stopPropagation();
h.remove(b);});var f=this.store[b].anchor;var l=f.html();f.empty().click(function(t){t.preventDefault();t.stopPropagation();h.select(b);});var c=a("<div>").addClass("ctabs-ctab-title-wrapper").appendTo(o);
var p=a("<div>").addClass("ctabs-head-table").appendTo(c);var e=a("<div>").addClass("ctabs-table-cell-left").append(f).appendTo(p);var s=a("<span>").html(l).appendTo(f);
this.store[b].marker=a("<span>").insertBefore(s);a.extend(this.store[b],{ctab:r,iconWrapper:g,close:m,title:s});},_resize:function(){if(this.options.cssFlex){return;
}var d=this._workflow;var c=this._nodes.headCenter.children(".ctabs-ctab");var g=c.first();var f=parseFloat(c.size());d.minTabWidth=d.minTabWidth||parseInt(g.css("min-width"));
d.maxTabWidth=d.maxTabWidth||parseInt(g.css("max-width"));var e=g.width();var l=this._nodes.headCenter.width();var k=this._nodes.adder.width();var h=k+f*e-(f-1)*this._settings.overlap;
var b=k+f*d.maxTabWidth-(f-1)*this._settings.overlap;var j=k+f*d.minTabWidth-(f-1)*this._settings.overlap;var i=e;if(l>=b){i=d.maxTabWidth;}else{if(l<=j){i=d.minTabWidth;
}else{i=(l-k+(f-1)*this._settings.overlap)/f;}}if(i!=e){c.width(i);}window.clearTimeout(d.resizeTimeout);d.resizeTimeout=window.setTimeout(function(){d.minTabWidth=null;
d.maxTabWidth=null;},this._settings.resizeCacheDelay);},_stopSort:function(){this.hashes=a.map(this._nodes.headCenter.children(".ctabs-ctab"),function(b){return a(b).attr("hash");
});this._updateActive();},_updateActive:function(){if(!this._workflow.currentHash){this.options.active=null;}var b=a.inArray(this._workflow.currentHash,this.hashes);
this.options.active=b>=0?b:null;},_applyActive:function(b){this.select(b);return true;},_applyHeadLeft:function(b){this._nodes.headLeft.empty().append(b);
return true;},_applyHeadLeftWidth:function(b){this._nodes.headLeftWrapper.css("width",b);this._nodes.headCenterWrapper.css("left",b);return true;},_applyHeadRight:function(b){this._nodes.headRight.empty().append(b);
return true;},_applyHeadRightWidth:function(b){this._nodes.headRightWrapper.css("width",b);this._nodes.headCenterWrapper.css("right",b);return true;},_applyHeight:function(b){this.element.css("height",b);
return true;},_applyMarker:function(c){var b=this;a.each(this.store,function(d){b.mark(d,undefined,c);});return true;},_applyWidth:function(b){this.element.css("width",b);
return true;},_getHash:function(b){if(typeof(b)=="number"){return this.hashes[b]||b;}return b;},add:function(g,f){if(this.store[g]){return;}f=a.extend({title:"",content:"",icon:a()},f);
var b=this.element.find("ol, ul").first();var e=a("<li>").appendTo(b);var d=a("<a>").attr("href",g).append(f.title).appendTo(e);var c;if(typeof(f.content)=="string"){c=a("<div>").append(f.content);
}else{c=a(f.content);}c.attr("id",g.substr(1));this.element.append(c);this.store[g]={hash:g,tab:e,anchor:d,panel:c,icon:f.icon};this.hashes.push(g);this._createCTab(g);
if(a.isFunction(this.options.afterAdd)){this.options.afterAdd(g);}return this.store[g];},remove:function(c){c=this._getHash(c);if(!this.store[c]){return;
}if(this.deselect(c)===false){return false;}if(a.isFunction(this.options.beforeRemove)){if(this.options.beforeRemove(c)===false){return false;}}this.store[c].ctab.remove();
this.store[c].panel.remove();this._resize();var b=a.inArray(c,this.hashes);if(b>=0){this.hashes.splice(b,1);}delete this.store[c];if(a.isFunction(this.options.afterRemove)){this.options.afterRemove(c);
}},get:function(c,b){c=this._getHash(c);if(!this.store[c]){return null;}return b?this.store[c][b]:this.store[c];},nodes:function(b){return b?this._nodes[b]:this._nodes;
},select:function(b){b=this._getHash(b);if(!this.store[b]){return;}if(this.deselect()===false){return false;}if(a.isFunction(this.options.beforeSelect)){if(this.options.beforeSelect(b)===false){return false;
}}this.store[b].panel.show();this.store[b].ctab.toggleClass("ctabs-ctab-active",true);this._workflow.currentHash=b;this._updateActive();if(this.options.showHash){window.location.hash=b;
}if(a.isFunction(this.options.afterSelect)){this.options.afterSelect(b);}},deselect:function(b){b=this._getHash(b);if(!this._workflow.currentHash||!this.store[this._workflow.currentHash]){return;
}if(b&&this._workflow.currentHash!=b){return;}if(a.isFunction(this.options.beforeDeselect)){if(this.options.beforeDeselect(this._workflow.currentHash)===false){return false;
}}this.store[this._workflow.currentHash].panel.hide();this.store[this._workflow.currentHash].ctab.toggleClass("ctabs-ctab-active",false);this._workflow.currentHash=null;
this._updateActive();if(a.isFunction(this.options.afterDeselect)){this.options.afterDeselect(b);}},title:function(b,c){b=this._getHash(b);if(!this.store[b]){return;
}if(!c){return this.store[b].title.html();}this.store[b].title.html(c);},icon:function(c,b){c=this._getHash(c);if(!this.store[c]){return;}if(!b){return this.store[c].icon;
}if(a.isFunction(this.options.iconFormatter)){b=this.options.iconFormatter(c,this.store[c].icon,b);if(!b){return;}}this.store[c].icon=b;this.store[c].iconWrapper.empty().append(b);
},modified:function(b){b=this._getHash(b);if(!this.store[b]){return null;}return !!this.store[b].marker.html();},mark:function(d,c,b){d=this._getHash(d);
if(!this.store[d]){return;}if(c===undefined){c=this.modified(d);}this.store[d].marker.html(c?(b||this.options.marker):"");},resize:function(){this._resize();
}});})(jQuery);